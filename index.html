<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Next Bus - Ma Wan ‚Üî Kwai Fong</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg: #ffe4ec;
            --card-bg: #fff0f5;
            --text: #5c3a4d;
            --text-secondary: #a67c8a;
            --accent: #ff6b9d;
            --success: #ff4757;
            --warning: #ffa502;
        }

        body {
            font-family: 'Permanent Marker', cursive, sans-serif;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255,182,193,0.4) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255,218,185,0.4) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(255,240,245,0.6) 0%, transparent 70%),
                var(--bg);
            background-attachment: fixed;
            color: var(--text);
            min-height: 100vh;
            padding: 60px 16px 20px;
        }

        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 60px 16px 16px;
            background: linear-gradient(180deg, var(--bg) 0%, transparent 100%);
            z-index: 100;
            text-align: center;
        }

        h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .dessert-bg {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }

        .dessert-bg span {
            position: absolute;
            font-size: 24px;
            opacity: 0.3;
            animation: float 6s ease-in-out infinite;
        }

        .dessert-bg span:nth-child(1) { top: 10%; left: 5%; animation-delay: 0s; }
        .dessert-bg span:nth-child(2) { top: 30%; right: 10%; animation-delay: 1s; }
        .dessert-bg span:nth-child(3) { top: 50%; left: 8%; animation-delay: 2s; }
        .dessert-bg span:nth-child(4) { top: 70%; right: 5%; animation-delay: 3s; }
        .dessert-bg span:nth-child(5) { top: 85%; left: 15%; animation-delay: 4s; }
        .dessert-bg span:nth-child(6) { top: 15%; right: 20%; animation-delay: 5s; }
        .dessert-bg span:nth-child(7) { top: 60%; left: 25%; animation-delay: 2.5s; }
        .dessert-bg span:nth-child(8) { top: 40%; right: 25%; animation-delay: 1.5s; }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin: 80px 0 24px 0;
        }

        .tab {
            flex: 1;
            padding: 12px 16px;
            background: var(--card-bg);
            border: none;
            border-radius: 12px;
            color: var(--text);
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab.active {
            background: var(--accent);
            color: white;
        }

        .tab:active {
            opacity: 0.7;
        }

        .refresh-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--accent);
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(255,107,157,0.4);
        }

        .route-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(92,58,77,0.1);
        }

        .route-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .eta-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px;
            background: white;
            border-radius: 12px;
            margin-bottom: 8px;
            box-shadow: 0 1px 4px rgba(92,58,77,0.08);
        }

        .route-number {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent);
        }

        .route-direction {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .day-type {
            text-align: center;
            padding: 8px;
            background: rgba(10, 132, 255, 0.15);
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 13px;
            color: var(--accent);
        }

        .eta-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .eta-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }

        .eta-time {
            font-size: 20px;
            font-weight: 600;
        }

        .eta-time.now {
            color: #ff2d55;
            font-weight: 700;
        }

        .eta-time.soon {
            color: #ff6b9d;
        }

        .eta-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .no-buses {
            text-align: center;
            padding: 24px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .last-updated {
            text-align: center;
            padding: 16px;
            color: var(--text-secondary);
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="dessert-bg">
        <span>üç∞</span>
        <span>üßÅ</span>
        <span>üç©</span>
        <span>üç™</span>
        <span>üç¶</span>
        <span>üçÆ</span>
        <span>ü•ê</span>
        <span>üçØ</span>
    </div>

    <div class="header">
        <h1>Next Bus</h1>
        <p class="subtitle">NR332 Ma Wan ‚Üî Kwai Fong</p>
    </div>

    <div class="tabs">
        <button class="tab active" onclick="setDirection('toKwaiFong')">‚Üí Kwai Fong</button>
        <button class="tab" onclick="setDirection('toMaWan')">‚Üí Ma Wan</button>
    </div>

    <div class="day-type" id="dayType"></div>

    <div id="content"></div>

    <div class="last-updated" id="lastUpdated"></div>

    <button class="refresh-btn" onclick="renderSchedule()">‚Üª</button>

    <script>
        const SCHEDULE = {
            weekday: {
                toKwaiFong: [
                    [6,0],[6,15],[6,30],[6,40],[6,50],
                    [7,0],[7,10],[7,20],[7,30],[7,38],[7,46],[7,54],
                    [8,2],[8,10],[8,18],[8,26],[8,34],[8,42],[8,50],
                    [9,0],[9,10],[9,20],[9,30],[9,40],[9,50],
                    [10,0],[10,12],[10,24],[10,36],[10,48],
                    [11,0],[11,12],[11,24],[11,36],[11,48],
                    [12,0],[12,12],[12,24],[12,36],[12,48],
                    [13,0],[13,12],[13,24],[13,36],[13,48],
                    [14,0],[14,12],[14,24],[14,36],[14,48],
                    [15,0],[15,12],[15,24],[15,36],[15,48],
                    [16,0],[16,12],[16,24],[16,36],[16,48],
                    [17,0],[17,10],[17,20],[17,30],[17,40],[17,50],
                    [18,0],[18,10],[18,20],[18,30],[18,40],[18,50],
                    [19,0],[19,12],[19,24],[19,36],[19,48],
                    [20,0],[20,12],[20,24],[20,36],[20,48],
                    [21,0],[21,12],[21,24],[21,36],[21,48],
                    [22,0],[22,12],[22,24],[22,36],[22,48],
                    [23,0],[23,15],[23,30],[23,45],
                    [0,0],[0,15],[0,45],
                    [1,0],[1,45],
                    [2,30],
                    [3,15],
                    [4,0],[4,45],
                    [5,30]
                ],
                toMaWan: [
                    [6,20],[6,35],[6,45],[6,55],
                    [7,5],[7,15],[7,25],[7,35],[7,45],[7,55],
                    [8,5],[8,15],[8,25],[8,35],[8,45],[8,55],
                    [9,5],[9,15],[9,25],[9,35],[9,45],
                    [10,0],[10,12],[10,24],[10,36],[10,48],
                    [11,0],[11,12],[11,24],[11,36],[11,48],
                    [12,0],[12,12],[12,24],[12,36],[12,48],
                    [13,0],[13,12],[13,24],[13,36],[13,48],
                    [14,0],[14,12],[14,24],[14,36],[14,48],
                    [15,0],[15,12],[15,24],[15,36],[15,48],
                    [16,0],[16,12],[16,24],[16,36],[16,48],
                    [17,0],[17,10],[17,20],[17,30],[17,40],[17,50],[17,58],
                    [18,6],[18,14],[18,22],[18,30],[18,38],[18,46],[18,54],
                    [19,2],[19,10],[19,18],[19,26],[19,34],[19,42],[19,50],[19,58],
                    [20,6],[20,14],[20,22],[20,30],[20,38],[20,46],[20,54],
                    [21,2],[21,10],[21,18],[21,26],[21,34],[21,42],[21,50],[21,58],
                    [22,6],[22,14],[22,22],[22,30],[22,38],[22,46],[22,54],
                    [23,2],[23,15],[23,30],[23,45],
                    [0,0],[0,30],
                    [1,0],[1,25],
                    [2,10],[2,55],
                    [3,40],
                    [4,25],
                    [5,10],[5,55]
                ]
            },
            weekend: {
                toKwaiFong: [
                    [6,0],[6,15],[6,30],[6,40],[6,50],
                    [7,0],[7,10],[7,20],[7,30],[7,40],[7,50],
                    [8,0],[8,10],[8,20],[8,30],[8,40],[8,50],
                    [9,0],[9,10],[9,20],[9,30],[9,45],
                    [10,0],[10,12],[10,24],[10,36],[10,48],
                    [11,0],[11,12],[11,24],[11,36],[11,48],
                    [12,0],[12,12],[12,24],[12,36],[12,48],
                    [13,0],[13,12],[13,24],[13,36],[13,48],
                    [14,0],[14,12],[14,24],[14,36],[14,48],
                    [15,0],[15,12],[15,24],[15,36],[15,48],
                    [16,0],[16,12],[16,24],[16,36],[16,48],
                    [17,0],[17,10],[17,20],[17,30],[17,40],[17,50],
                    [18,0],[18,10],[18,20],[18,30],[18,40],[18,50],
                    [19,0],[19,12],[19,24],[19,36],[19,48],
                    [20,0],[20,12],[20,24],[20,36],[20,48],
                    [21,0],[21,12],[21,24],[21,36],[21,48],
                    [22,0],[22,12],[22,24],[22,36],[22,48],
                    [23,0],[23,15],[23,30],[23,45],
                    [0,0],[0,15],[0,45],
                    [1,0],[1,45],
                    [2,30],
                    [3,15],
                    [4,0],[4,45],
                    [5,30]
                ],
                toMaWan: [
                    [6,20],[6,35],[6,45],[6,55],
                    [7,5],[7,15],[7,25],[7,35],[7,45],[7,55],
                    [8,5],[8,15],[8,25],[8,35],[8,45],[8,55],
                    [9,5],[9,15],[9,25],[9,35],[9,45],
                    [10,0],[10,12],[10,24],[10,36],[10,48],
                    [11,0],[11,12],[11,24],[11,36],[11,48],
                    [12,0],[12,12],[12,24],[12,36],[12,48],
                    [13,0],[13,12],[13,24],[13,36],[13,48],
                    [14,0],[14,12],[14,24],[14,36],[14,48],
                    [15,0],[15,12],[15,24],[15,36],[15,48],
                    [16,0],[16,12],[16,24],[16,36],[16,48],
                    [17,0],[17,10],[17,20],[17,30],[17,40],[17,50],
                    [18,0],[18,10],[18,20],[18,30],[18,38],[18,46],[18,54],
                    [19,2],[19,10],[19,18],[19,26],[19,34],[19,42],[19,50],[19,58],
                    [20,6],[20,14],[20,22],[20,30],[20,38],[20,46],[20,54],
                    [21,2],[21,10],[21,18],[21,26],[21,34],[21,42],[21,50],[21,58],
                    [22,6],[22,14],[22,22],[22,30],[22,38],[22,46],[22,54],
                    [23,2],[23,15],[23,30],[23,45],
                    [0,0],[0,30],
                    [1,0],[1,25],
                    [2,10],[2,55],
                    [3,40],
                    [4,25],
                    [5,10],[5,55]
                ]
            }
        };

        let currentDirection = 'toKwaiFong';

        function isWeekend() {
            const day = new Date().getDay();
            return day === 0 || day === 6;
        }

        function setDirection(dir) {
            currentDirection = dir;
            document.querySelectorAll('.tab').forEach((tab, i) => {
                tab.classList.toggle('active', 
                    (dir === 'toKwaiFong' && i === 0) || 
                    (dir === 'toMaWan' && i === 1)
                );
            });
            renderSchedule();
        }

        function getNextBuses(schedule) {
            const now = new Date();
            const currentMins = now.getHours() * 60 + now.getMinutes();
            const nextBuses = [];

            for (let i = 0; i < schedule.length; i++) {
                const [h, m] = schedule[i];
                const busMins = h * 60 + m;
                
                if (busMins > currentMins) {
                    nextBuses.push({ time: schedule[i], minsUntil: busMins - currentMins });
                    if (nextBuses.length >= 3) break;
                }
            }

            if (nextBuses.length === 0) {
                const [h, m] = schedule[0];
                nextBuses.push({ time: schedule[0], minsUntil: (24 * 60) - currentMins + (h * 60 + m), tomorrow: true });
            }

            return nextBuses;
        }

        function renderSchedule() {
            const dayType = isWeekend() ? 'weekend' : 'weekday';
            const schedule = SCHEDULE[dayType][currentDirection];
            const nextBuses = getNextBuses(schedule);
            
            document.getElementById('dayType').textContent = 
                dayType === 'weekend' ? 'üìÖ Saturday / Sunday / Public Holiday' : 'üìÖ Monday - Friday';

            const content = document.getElementById('content');
            const directionLabel = currentDirection === 'toKwaiFong' 
                ? 'Ma Wan ‚Üí Kwai Fong' 
                : 'Kwai Fong ‚Üí Ma Wan';

            const etaHtml = nextBuses.map(bus => {
                let timeClass = '';
                if (bus.minsUntil <= 5) timeClass = 'now';
                else if (bus.minsUntil <= 15) timeClass = 'soon';

                const timeStr = bus.tomorrow 
                    ? `Tomorrow ${bus.time[0]}:${String(bus.time[1]).padStart(2, '0')}`
                    : bus.minsUntil === 0 
                        ? 'Now'
                        : `${bus.minsUntil} min`;

                return `
                    <div class="eta-item">
                        <div>
                            <div class="eta-time ${timeClass}">${timeStr}</div>
                            <div class="eta-label">${bus.time[0]}:${String(bus.time[1]).padStart(2, '0')}</div>
                        </div>
                    </div>
                `;
            }).join('');

            content.innerHTML = `
                <div class="route-card">
                    <div class="route-header">
                        <div>
                            <div class="route-number">NR332</div>
                            <div class="route-direction">${directionLabel}</div>
                        </div>
                    </div>
                    <div class="eta-list">
                        ${etaHtml}
                    </div>
                </div>
            `;

            document.getElementById('lastUpdated').textContent = 
                `Updated ${new Date().toLocaleTimeString()}`;
        }

        renderSchedule();
        setInterval(renderSchedule, 60000);
    </script>
</body>
</html>
